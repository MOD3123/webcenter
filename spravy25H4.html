<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Spr√°vy SK</title>
<style>

  :root {
    --text-primary: #1a1a1a;
    --text-secondary: #4a4a4a;
    --text-tertiary: #6b6b6b;
    --accent: #2563eb;
    --accent-hover: #1d4ed8;
    --accent-light: #dbeafe;
    --accent-alt: #059669;
    --accent-alt-hover: #047857;
    --accent-alt-light: #d1fae5;
    --border: #e2e8f0;
    --border-light: #f1f5f9;
    --card-bg: #ffffff;
    --card-bg-hover: #f8fafc;
    --bg: #f8fafc;
    --bg-elevated: #ffffff;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 14px;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-tertiary: #64748b;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --accent-light: rgba(59, 130, 246, 0.2);
      --accent-alt: #10b981;
      --accent-alt-hover: #059669;
      --accent-alt-light: rgba(16, 185, 129, 0.2);
      --border: #334155;
      --border-light: #1e293b;
      --card-bg: #1e293b;
      --card-bg-hover: #334155;
      --bg: #0f172a;
      --bg-elevated: #1e293b;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.5);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.6);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.7);
    }
  }

  * { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    background: var(--bg);
    color: var(--text-primary);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  ::-webkit-scrollbar { 
    width: 12px; 
  }
  ::-webkit-scrollbar-track { 
    background: var(--bg); 
  }
  ::-webkit-scrollbar-thumb { 
    background: var(--border); 
    border-radius: 6px;
    border: 3px solid var(--bg);
  }
  ::-webkit-scrollbar-thumb:hover { 
    background: var(--text-tertiary); 
  }

  header {
    display: none;
  }

  #source-selection {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 160px);
    padding: 40px 20px;
  }
  
  .source-menu {
    background: var(--card-bg);
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    max-width: 1200px;
    width: 100%;
    padding: 64px 56px;
  }
  
  .source-menu h2 {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 48px;
    letter-spacing: -0.04em;
    text-align: center;
    color: var(--text-primary);
  }
  
  .source-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 16px;
  }
  
  .source-btn {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
    border: 2px solid var(--border);
    border-radius: var(--radius-md);
    padding: 16px 24px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
    transition: all 0.15s ease;
  }

  .source-btn:hover {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(16, 185, 129, 0.15));
    border-color: var(--accent);
    box-shadow: var(--shadow-md);
  }

  .source-btn:active {
    transform: translateY(0);
  }

  .source-btn.primary-action {
    grid-column: 1 / -1;
    font-size: 16px;
    padding: 20px;
    font-weight: 700;
  }

  .source-btn.all-sources {
    background: linear-gradient(135deg, var(--accent), #1d4ed8);
    color: white;
    border-color: var(--accent);
    box-shadow: var(--shadow-md);
  }
  
  .source-btn.all-sources:hover {
    background: linear-gradient(135deg, var(--accent-hover), #1e40af);
    box-shadow: var(--shadow-lg);
  }
  
  .source-btn.website-list {
    background: linear-gradient(135deg, var(--accent-alt), #047857);
    color: white;
    border-color: var(--accent-alt);
    box-shadow: var(--shadow-md);
  }
  
  .source-btn.website-list:hover {
    background: linear-gradient(135deg, var(--accent-alt-hover), #065f46);
    box-shadow: var(--shadow-lg);
  }

  #content-view {
    display: none;
  }
  
  #content-view.active {
    display: block;
  }

  .toolbar {
    max-width: 1440px;
    margin: 32px auto;
    padding: 0 20px;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
  }
  
  .back-btn {
    background: var(--card-bg);
    color: var(--text-primary);
    border: 2px solid var(--border);
    padding: 10px 16px;
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.15s ease;
    display: flex;
    gap: 8px;
    align-items: center;
    box-shadow: var(--shadow-sm);
  }

  .back-btn:hover {
    background: var(--card-bg-hover);
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: var(--shadow-md);
  }
  
  .search-box {
    flex: 1;
    min-width: 300px;
    position: relative;
  }
  
  .search-box input {
    width: 100%;
    padding: 12px 20px 12px 44px;
    border: 2px solid var(--border);
    border-radius: var(--radius-md);
    background: var(--card-bg);
    color: var(--text-primary);
    font-size: 1rem;
    font-weight: 500;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-sm);
  }
  
  .search-box input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-light);
  }
  
  .search-box input::placeholder {
    color: var(--text-tertiary);
  }
  
  .search-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    pointer-events: none;
    font-size: 1.125rem;
  }
  
  .filter-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  
  .filter-btn {
    background: var(--card-bg);
    color: var(--text-primary);
    border: 2px solid var(--border);
    padding: 10px 18px;
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.15s ease;
    box-shadow: var(--shadow-sm);
  }

  .filter-btn:hover {
    background: var(--card-bg-hover);
    border-color: var(--accent);
    box-shadow: var(--shadow-md);
  }

  .filter-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
    box-shadow: var(--shadow-md);
  }

  #rss-feed {
    max-width: 1440px;
    margin: 0 auto 48px;
    padding: 0 20px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
    gap: 24px;
  }

  @media (max-width: 768px) {
    header {
      padding: 32px 20px;
    }
    
    .source-menu {
      padding: 40px 24px;
    }
    
    .source-menu h2 {
      font-size: 1.75rem;
    }
    
    #rss-feed {
      grid-template-columns: 1fr;
    }
    
    .toolbar {
      flex-direction: column;
      align-items: stretch;
    }
    
    .source-grid {
      grid-template-columns: 1fr;
    }
  }

  .item-card {
    background: var(--card-bg);
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    display: flex;
    flex-direction: column;
    box-shadow: var(--shadow-sm);
    transition: all 0.2s ease;
    overflow: hidden;
  }
  
  .item-card:hover { 
    box-shadow: var(--shadow-lg);
    border-color: var(--accent);
  }

  .item-thumb {
    width: 100%;
    height: 260px;
    object-fit: cover;
    background: var(--card-bg-hover);
  }
  
  video.item-thumb {
    height: 260px;
  }

  .item-content { 
    padding: 28px; 
    display: flex; 
    flex-direction: column; 
    flex: 1; 
  }
  
  .item-content h2 { 
    margin: 0 0 16px; 
    font-size: 1.25rem; 
    font-weight: 700;
    line-height: 1.4;
    letter-spacing: -0.015em;
  }
  
  .item-content h2 a { 
    text-decoration: none; 
    color: var(--text-primary); 
    transition: color 0.2s ease;
  }
  
  .item-content h2 a:hover {
    color: var(--accent);
  }
  
  .badges { 
    display: flex; 
    gap: 10px; 
    margin-bottom: 16px; 
    flex-wrap: wrap; 
  }
  
  .badge { 
    font-size: 0.75rem; 
    padding: 6px 12px; 
    background: var(--accent-light); 
    color: var(--accent); 
    border-radius: 6px; 
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .badge.source { 
    background: var(--border-light); 
    color: var(--text-secondary);
  }
  
  .badge.today {
    background: #dcfce7;
    color: #16a34a;
  }
  
  @media (prefers-color-scheme: dark) {
    .badge.today {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
    }
  }
  
  .item-content p { 
    flex: 1; 
    margin: 0 0 20px; 
    font-size: 0.9375rem; 
    color: var(--text-secondary); 
    line-height: 1.7; 
  }
  
  .read-more-btn { 
    width: 100%; 
    padding: 14px 20px; 
    font-size: 1rem; 
    background: var(--accent);
    color: white; 
    border-radius: var(--radius-md); 
    text-align: center; 
    font-weight: 700; 
    text-decoration: none; 
    transition: all 0.2s ease; 
    border: none;
    cursor: pointer;
  }
  
  .read-more-btn:hover { 
    background: var(--accent-hover);
    box-shadow: var(--shadow-md);
  }
  
  .read-more-btn:active {
    transform: translateY(0);
  }

  .message-box {
    grid-column: 1 / -1;
    text-align: center;
    background: var(--card-bg);
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 48px;
    box-shadow: var(--shadow-sm);
    color: var(--text-secondary);
    font-weight: 600;
    font-size: 1.125rem;
  }
  
  .loading-msg { 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    gap: 12px; 
    min-height: 120px; 
  }

  .dot {
    width: 12px; 
    height: 12px;
    background: var(--accent);
    border-radius: 50%;
  }

  .stats {
    max-width: 1440px;
    margin: 24px auto;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: var(--text-secondary);
    font-size: 0.9375rem;
    font-weight: 600;
  }
  
  @media (max-width: 640px) {
    .stats {
      flex-direction: column;
      gap: 8px;
      text-align: center;
    }
  }

  #back-to-top {
    position: fixed;
    bottom: 32px;
    right: 32px;
    width: 56px;
    height: 56px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 1.5rem;
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    z-index: 99;
  }
  
  #back-to-top.visible {
    opacity: 1;
    visibility: visible;
  }
  
  #back-to-top:hover {
    background: var(--accent-hover);
  }
  
  #back-to-top:active {
    transform: translateY(-2px);
  }

  .source-category {
    margin-top: 32px;
  }
  
  .source-category-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 16px;
    padding: 0 4px;
  }
  
  .view-mode-toggle {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }
  
  .view-mode-btn {
    background: var(--card-bg);
    color: var(--text-primary);
    border: 2px solid var(--border);
    padding: 10px 18px;
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.15s ease;
    box-shadow: var(--shadow-sm);
  }

  .view-mode-btn:hover {
    background: var(--card-bg-hover);
    border-color: var(--accent);
    box-shadow: var(--shadow-md);
  }

  .view-mode-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
    box-shadow: var(--shadow-md);
  }
  
  #rss-feed.compact-view {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  #rss-feed.compact-view .item-card {
    flex-direction: row;
    align-items: stretch;
  }
  
  #rss-feed.compact-view .item-thumb {
    width: 200px;
    height: auto;
    min-height: 160px;
  }
  
  #rss-feed.compact-view .item-content {
    padding: 20px;
  }
  
  #rss-feed.compact-view .item-content h2 {
    font-size: 1.125rem;
    margin-bottom: 12px;
  }
  
  #rss-feed.compact-view .item-content p {
    font-size: 0.875rem;
    margin-bottom: 16px;
  }
  
  @media (max-width: 768px) {
    #rss-feed.compact-view .item-card {
      flex-direction: column;
    }
    
    #rss-feed.compact-view .item-thumb {
      width: 100%;
      height: 200px;
    }
  }

</style>
</head>
<body>

<header>
  <h1>Spr√°vy SK</h1>
  <p>Agreg√°tor slovensk√Ωch a ƒçesk√Ωch spr√°v</p>
</header>

<div id="source-selection">
  <div class="source-menu">
    <h2>Vyberte zdroj spr√°v</h2>
    <div class="source-grid" id="source-grid"></div>
  </div>
</div>

<div id="content-view">
  <div class="toolbar">
    <button class="back-btn" id="back-btn">
      <span>‚Üê</span>
      <span>Ponuka</span>
    </button>
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input type="text" id="search-input" placeholder="Hƒæada≈• v nadpisoch a textoch...">
    </div>
    <div class="filter-buttons">
      <button class="filter-btn active" data-filter="all">V≈°etky</button>
      <button class="filter-btn" data-filter="today">Dnes</button>
      <button class="filter-btn" data-filter="video">Video</button>
    </div>
    <div class="filter-buttons">
      <button class="view-mode-btn active" data-view="grid">Mrie≈æka</button>
      <button class="view-mode-btn" data-view="compact">Kompakt</button>
    </div>
  </div>

  <div class="stats">
    <span id="count-info">Naƒç√≠tavam...</span>
    <span id="last-update"></span>
  </div>

  <div id="rss-feed">
    <div class="message-box loading-msg">
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
  </div>
</div>

<button id="back-to-top" title="Sp√§≈• na vrch">‚Üë</button>

<script>
(async function(){
  const FEEDS = {
    "V≈°etky spr√°vy": [
      "https://spravy.pravda.sk/rss/xml","https://domov.sme.sk/rss","https://hnonline.sk/feed",
      "https://touchit.sk/feed","https://www.teraz.sk/rss/vsetky-spravy.rss","https://www.startitup.sk/feed/",
      "https://www.ta3.com/rss/5/spravy","https://www.info.sk/rss/","https://www.novinky.cz/rss",
      "https://www.imeteo.sk/rss/news","https://spravy.pravda.sk/regiony/rss/xml/","https://sita.sk/feed/",
      "https://www.ceskenoviny.cz/sluzby/rss/zpravy.php","https://refresher.sk/rss","https://www.bratislavak.sk/rss",
      "https://sportweb.pravda.sk/rss/xml/","https://www.aktuality.sk/rss/","https://zive.aktuality.sk/rss/najnovsie/",
      "https://www.zive.cz/rss","https://www.reflex.cz/rss","https://www.mojandroid.sk/feed/atom/",
      "https://androidportal.sk/feed/","https://spravy.stvr.sk/feed/","https://www.blesk.cz/rss",
      "https://www.newsbyte.sk/feed/","https://ereport.sk/feed","https://standard.sk/feed","https://www.postoj.sk/rss",
      "https://cz24.news/feed/"
    ],
    "CZ24.news": ["https://cz24.news/feed/"],
    "eReport": ["https://ereport.sk/feed"],
    "Pravda.sk": ["https://spravy.pravda.sk/rss/xml"],
    "SME.sk": ["https://domov.sme.sk/rss"],
    "HNonline": ["https://hnonline.sk/feed"],
    "TouchIT": ["https://touchit.sk/feed"],
    "Teraz.sk": ["https://www.teraz.sk/rss/vsetky-spravy.rss"],
    "Startitup": ["https://www.startitup.sk/feed/"],
    "TA3": ["https://www.ta3.com/rss/5/spravy"],
    "Info.sk": ["https://www.info.sk/rss/"],
    "Novinky.cz": ["https://www.novinky.cz/rss"],
    "iMeteo": ["https://www.imeteo.sk/rss/news"],
    "SITA": ["https://sita.sk/feed/"],
    "ƒåesk√© Noviny": ["https://www.ceskenoviny.cz/sluzby/rss/zpravy.php"],
    "Refresher": ["https://refresher.sk/rss"],
    "Bratislav√°k": ["https://www.bratislavak.sk/rss"],
    "≈†port Pravda": ["https://sportweb.pravda.sk/rss/xml/"],
    "Aktuality.sk": ["https://www.aktuality.sk/rss/"],
    "≈Ωiv√©.sk": ["https://zive.aktuality.sk/rss/najnovsie/"],
    "Zive.cz": ["https://www.zive.cz/rss"],
    "Reflex": ["https://www.reflex.cz/rss"],
    "MojAndroid": ["https://www.mojandroid.sk/feed/atom/"],
    "AndroidPortal": ["https://androidportal.sk/feed/"],
    "RTVS": ["https://spravy.stvr.sk/feed/"],
    "Blesk.cz": ["https://www.blesk.cz/rss"],
    "NewsByte": ["https://www.newsbyte.sk/feed/"],
    "Standard": ["https://standard.sk/feed"],
    "Postoj": ["https://www.postoj.sk/rss"]
  };

  const PAGE_SIZE = 12;
  const BATCH_SIZE = 5;
  let allItems = [], filteredItems = [], index = 0;
  let currentFilter = 'all', searchQuery = '';
  let selectedSource = null;

  const sourceSelection = document.getElementById("source-selection");
  const contentView = document.getElementById("content-view");
  const sourceGrid = document.getElementById("source-grid");
  const container = document.getElementById("rss-feed");
  const searchInput = document.getElementById("search-input");
  const countInfo = document.getElementById("count-info");
  const lastUpdate = document.getElementById("last-update");
  const backToTop = document.getElementById("back-to-top");
  const backBtn = document.getElementById("back-btn");

  function showSourceMenu() {
    sourceSelection.style.display = "flex";
    contentView.classList.remove("active");
    window.scrollTo(0, 0);
  }

  function showContent() {
    sourceSelection.style.display = "none";
    contentView.classList.add("active");
  }

  function showWebsiteList() {
    window.open('https://no-ship-it26.github.io/webcenter/spravodajske_weby', '_blank');
  }

  function initSourceMenu() {
    sourceGrid.innerHTML = '';
    
    const allBtn = document.createElement('button');
    allBtn.className = 'source-btn primary-action all-sources';
    allBtn.textContent = 'üì∞ V≈°etky spr√°vy';
    allBtn.onclick = () => selectSource('V≈°etky spr√°vy');
    sourceGrid.appendChild(allBtn);

    const listBtn = document.createElement('button');
    listBtn.className = 'source-btn primary-action website-list';
    listBtn.textContent = 'üìã Zoznam webov';
    listBtn.onclick = showWebsiteList;
    sourceGrid.appendChild(listBtn);

    Object.keys(FEEDS).forEach(name => {
      if (name === 'V≈°etky spr√°vy') return;
      const btn = document.createElement('button');
      btn.className = 'source-btn';
      btn.textContent = name;
      btn.onclick = () => selectSource(name);
      sourceGrid.appendChild(btn);
    });
  }

  async function selectSource(sourceName) {
    selectedSource = sourceName;
    showContent();
    allItems = [];
    filteredItems = [];
    index = 0;
    container.innerHTML = '<div class="message-box loading-msg"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
    
    const feeds = FEEDS[sourceName];
    for (let i = 0; i < feeds.length; i += BATCH_SIZE) {
      const batch = feeds.slice(i, i + BATCH_SIZE);
      const results = await Promise.all(batch.map(fetchXMLFeed));
      allItems = allItems.concat(...results);
      allItems.sort((a, b) => b.pubDate - a.pubDate);
      
      if (i === 0) {
        applyFilters();
      }
    }
    applyFilters();
  }

  async function fetchXMLFeed(url){
    try{
      const res = await fetch("https://corsproxy.io/?" + encodeURIComponent(url), { timeout: 5000 });
      const text = await res.text();
      const xml = new DOMParser().parseFromString(text,"text/xml");
      const channel = xml.querySelector("channel");
      const source = channel?.querySelector("title")?.textContent || url;

      const items = [...xml.querySelectorAll("item")].map(item=>{
        let pub = new Date(
          item.querySelector("pubDate")?.textContent ||
          item.querySelector("updated")?.textContent ||
          item.querySelector("dc\\:date")?.textContent ||
          item.querySelector("date")?.textContent ||
          ""
        );
        if (isNaN(pub)) pub = new Date();

        let thumb = "", video = "";
        const enclosure = item.querySelector("enclosure");
        if(enclosure){
          const type = enclosure.getAttribute("type") || "";
          const url = enclosure.getAttribute("url") || "";
          if(type.startsWith("image")) thumb = url;
          else if(type.startsWith("video")) video = url;
        }

        if(!thumb){
          const media = item.querySelector("media\\:content, content");
          if(media && media.getAttribute("url")) thumb = media.getAttribute("url");
          else{
            const descHTML = item.querySelector("description")?.textContent || "";
            const match = descHTML.match(/<img[^>]+src="([^">]+)"/);
            if(match) thumb = match[1];
          }
        }

        let rawDesc = item.querySelector("description")?.textContent || "";
        rawDesc = rawDesc.replace(/<[^>]*>/g, "").trim();

        const descLimit = 200;
        let shortDesc = rawDesc.slice(0, descLimit);
        if (rawDesc.length > descLimit) {
          const lastSpace = shortDesc.lastIndexOf(" ");
          if(lastSpace > 0) shortDesc = shortDesc.slice(0, lastSpace);
        }

        return {
          title: item.querySelector("title")?.textContent || "",
          link: item.querySelector("link")?.textContent || "",
          desc: shortDesc,
          pubDate: pub,
          source,
          thumb,
          video
        };
      }).filter(it => it.title && it.link);
      return items;
    } catch(e){
      console.warn("Nepodarilo sa naƒç√≠ta≈• feed:", url, e);
      return [];
    }
  }

  const videoObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        const video = entry.target;
        video.src = video.dataset.src;
        video.load();
        observer.unobserve(video);
      }
    });
  }, { rootMargin: "200px" });

  function applyFilters(){
    filteredItems = allItems.filter(item => {
      let matchFilter = true;
      if(currentFilter === 'today'){
        const isToday = item.pubDate.toDateString() === new Date().toDateString();
        matchFilter = isToday;
      } else if(currentFilter === 'video'){
        matchFilter = !!item.video;
      }

      let matchSearch = true;
      if(searchQuery){
        const q = searchQuery.toLowerCase();
        matchSearch = item.title.toLowerCase().includes(q) || 
                     item.desc.toLowerCase().includes(q) ||
                     item.source.toLowerCase().includes(q);
      }

      return matchFilter && matchSearch;
    });

    index = 0;
    container.innerHTML = '';
    updateStats();
    renderNext();
  }

  function updateStats(){
    countInfo.textContent = `Zobrazen√Ωch: ${Math.min(index + PAGE_SIZE, filteredItems.length)} z ${filteredItems.length} ƒçl√°nkov`;
    lastUpdate.textContent = `Zdroj: ${selectedSource} ‚Ä¢ ${new Date().toLocaleTimeString('sk-SK')}`;
  }

  function renderNext(){
    const prevLoader = container.querySelector(".loading-msg");
    if(prevLoader) prevLoader.remove();

    if(index >= filteredItems.length){
      if(container.children.length === 0){
        const noResults = document.createElement("div");
        noResults.className = "message-box";
        noResults.textContent = "üòï Nena≈°li sa ≈æiadne v√Ωsledky";
        container.appendChild(noResults);
      } else {
        const end = document.createElement("div");
        end.className = "message-box";
        end.textContent = "‚úÖ V≈°etky ƒçl√°nky naƒç√≠tan√©";
        container.appendChild(end);
      }
      return;
    }

    const slice = filteredItems.slice(index, index + PAGE_SIZE);
    slice.forEach((i, idx) => {
      const card = document.createElement("div");
      card.className = "item-card";

      const isToday = i.pubDate.toDateString() === new Date().toDateString();
      const badgeDate = `${i.pubDate.toLocaleDateString("sk-SK")} ${i.pubDate.toLocaleTimeString("sk-SK",{hour:"2-digit",minute:"2-digit"})}`;

      card.innerHTML = `
        ${i.video 
          ? `<video class="item-thumb lazy-video" data-src="${i.video}" controls preload="metadata"></video>` 
          : (i.thumb ? `<img class="item-thumb" src="${i.thumb}" alt="${i.title}" loading="lazy">` : '')
        }
        <div class="item-content">
          <h2><a href="${i.link}" target="_blank" rel="noopener noreferrer">${i.title}</a></h2>
          <div class="badges">
            <span class="badge ${isToday ? 'today' : ''}">${badgeDate}</span>
            <span class="badge source">${i.source}</span>
          </div>
          <p>${i.desc}${i.desc.length >= 190 ? '...' : ''}</p>
          <a class="read-more-btn" href="${i.link}" target="_blank" rel="noopener noreferrer">ƒå√≠ta≈• cel√Ω ƒçl√°nok</a>
        </div>
      `;
      container.appendChild(card);

      const video = card.querySelector("video.lazy-video");
      if(video) videoObserver.observe(video);
    });

    index += slice.length;
    updateStats();

    if(index < filteredItems.length){
      window.addEventListener("scroll", onScroll, { passive: true });
    }
  }

  function onScroll(){
    if(window.innerHeight + window.scrollY + 200 >= document.body.scrollHeight){
      window.removeEventListener("scroll", onScroll);
      renderNext();
    }

    if(window.scrollY > 500){
      backToTop.classList.add('visible');
    } else {
      backToTop.classList.remove('visible');
    }
  }

  backToTop.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  backBtn.addEventListener('click', () => {
    showSourceMenu();
  });

  window.addEventListener('scroll', onScroll, { passive: true });

  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = btn.dataset.filter;
      applyFilters();
    });
  });

  document.querySelectorAll('.view-mode-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.view-mode-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const view = btn.dataset.view;
      if(view === 'compact'){
        container.classList.add('compact-view');
      } else {
        container.classList.remove('compact-view');
      }
    });
  });

  let searchTimeout;
  searchInput.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      searchQuery = e.target.value.trim();
      applyFilters();
    }, 300);
  });

  initSourceMenu();
})();
</script>
</body>
</html>
